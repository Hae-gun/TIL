

# SQL

## Join 처리 

> From->Where->order by->select

---

### Join 종류

cross join 

outer join

non-equi join

equi-join

self join

---

### 집계함수 Aggregate Function

#### 종류

* select에 다른 colum 못옴.

* AVG, COUNT, MAX, MIN, SUM.

* COUNT(*) -> NULL도 count됨.

* COUNT(expr) -> NULL count 안됨.

```sql
select avg(sal), count(*), min(sal), max(sal), count(mgr)
from emp
where deptno=10;

--where 조건을 통해 특정 부서 값 처리. 여러개 한번에 처리하기 위한것 -> group by절.
```

#### group by절

* 집계함수를 사용할 때 같은 colum로 집계할 때 사용
* 유일하게 group by 참여한 colum은 select 사용가능.

```sql
select avg(sal), count(*), min(sal), max(sal), count(mgr)
from emp
group by deptno;

select deptno "부서", avg(sal), count(*), min(sal), max(sal), count(mgr)
from emp
group by deptno;

```



### Having 절

* group by 이후 집계처리 이후 사용되는 조건절.

```sql
select e.deptno, dname, avg(sal)
from emp e, dept d
where e.deptno = d.deptno
group by e.deptno, dname 
having avg(sal)>=2000;
```

### subQuery

```sql
-- Ford 보다 급여가 많은 사원 목록.
select sal from emp where ename='FORD';

select * from emp where sal>3000;
-- Ford의 급여가 바뀌면 오류..

--subQuery 이용
select * from emp where sal > (select sal from emp where ename='FORD');

```

```sql
select ename,sal, (select round(avg(sal)) as 평균 from emp)
from emp;

--select에도 사용가능.
```

```sql
select * 
from emp 
where sal = (select max(sal) from emp group by deptno);
--error

--ORA-00904: "SELL": invalid identifier
--Elapsed Time:  0 hr, 0 min, 0 sec, 0 ms.

-- 이럴때 in 을 사용한다.

select * 
from emp 
where sal in (select max(sal) from emp group by deptno);
--이 코드도 위험함. 문제점 : max(sal)의 값이 어디서 온지 모름.

select * 
from emp 
where (deptno,sal) in (select deptno,max(sal) from emp group by deptno)
order by deptno;

```

### rownum

```sql
--rownum oracle에서 작동.
select ename, job,sal
from emp;

select rownum,ename, job,sal
from emp;


--rownum order by  이용
select rownum, ename,job,sal
from (select * from emp order by sal);

--급여 top3
select rownum, ename,job,sal
from (select * from emp order by sal desc) -- desc 내림차순
where rownum < 4; 

select rownum, ename,job,sal
from (select * from emp order by sal desc)
where rownum between 1 and 3; 
```

